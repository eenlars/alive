#!/bin/sh
# .husky/pre-commit

# SECURITY: Block .env files immediately (fast check)
if ! ./scripts/validation/check-no-env-files.sh; then
    echo ""
    echo "❌ SECURITY: .env files staged. Remove them before committing."
    exit 1
fi

# Keep codex skills aligned with claude skills and stage the mirrored copies.
if ! bun run sync:skills; then
    echo ""
    echo "❌ Failed to sync .claude/skills to .agents/skills."
    exit 1
fi

git add .agents/skills

# Only format files that are staged for commit (not the entire repo)
bun x lint-staged

# Type-check (turbo-cached, fast on warm cache)
bun run type-check
