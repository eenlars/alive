# /etc/caddy/Caddyfile - Main Caddy Configuration
#
# This file imports the generated sites configuration.
# Copy to /etc/caddy/Caddyfile on each server.
#
# Prerequisites:
# 1. Create /var/lib/alive/server-config.json with server identity
# 2. Run: bun run -C /path/to/alive/packages/site-controller routing:generate
# 3. Validate: caddy validate --config /etc/caddy/Caddyfile
# 4. Reload: systemctl reload caddy

{
    # For behind-nginx mode (nginx handles 80/443):
    http_port 8081
    https_port 8444

    # For direct mode (Caddy handles 80/443), comment out the above

    admin localhost:2019

    on_demand_tls {
        ask http://localhost:9000/api/tls-check
    }
}

# Shared snippets (common_headers, image_serving, preview_auth)
import /root/webalive/alive/ops/caddy/Caddyfile.snippets

# Production domains (edit manually, rarely changes)
import /etc/caddy/Caddyfile.prod

# Staging domains (optional)
import /etc/caddy/Caddyfile.staging

# Generated site routing (regenerate with routing:generate)
import /var/lib/alive/generated/Caddyfile.sites
